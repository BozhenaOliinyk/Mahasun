{% extends 'base.html' %}

{% block content %}
<h2>{{ title }}</h2>

{% if rows %}
<table>
    <thead>
        <tr>
            {% for header in headers %}
            <th>{{ header }}</th>
            {% endfor %}
            <th>Дії</th>
        </tr>
    </thead>
    <tbody>
        {% for row in rows %}
        <tr id="row-{{ row.id }}">
            {% for value in row.values %}
                <td>{{ value }}</td>
            {% endfor %}

            <td>
                {% if use_rest_delete %}
                    <button class="btn btn-danger" onclick="deleteItemRest('{{ row.id }}')">
                        Видалити
                    </button>
                {% else %}
                    <a href="{% url url_prefix|add:'_detail' pk=row.id %}" class="btn btn-primary">Деталі</a>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if use_rest_delete %}
<script>
    async function deleteItemRest(id) {
        if(!confirm("Ви впевнені, що хочете видалити цей запис з бази колеги?")) return;

        const apiUrl = `{{ api_url }}${id}/`;

        try {
            const response = await fetch(apiUrl, {
                method: 'DELETE',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                document.getElementById('row-' + id).remove();
            } else {
                alert("Помилка при видаленні!");
            }
        } catch (error) {
            console.error(error);
            alert("Помилка з'єднання з сервером");
        }
    }
</script>
{% endif %}

{% else %}
    <p>Список порожній.</p>
{% endif %}
{% endblock %}